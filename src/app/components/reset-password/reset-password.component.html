<div class="reset-password">
  <app-progress-bar *ngIf="loading"></app-progress-bar>
  
  <div *ngIf="!loading" class="row mt-1">
    <div class="col-lg-4 offset-lg-4">
      <div class="card text-white bg-secondary mb-3" style="max-width: 25rem;">
        
        <!-- Paso 1: Solicitar email -->
        <div *ngIf="step === 1" class="card-header text-center">Restablecer Contraseña</div>
        <div *ngIf="step === 1" class="card-body">
          <form [formGroup]="emailForm" (ngSubmit)="sendCode()">
            <p class="text-center mb-3">Ingresa tu email para recibir el código de verificación</p>
            <input formControlName="email" type="email" class="form-control mt-2" placeholder="Ingrese su email">
            <span *ngIf="emailForm.get('email')?.hasError('required') && emailForm.get('email')?.touched" class="text-danger">
              El email es <strong>requerido</strong>
            </span>
            <span *ngIf="emailForm.get('email')?.hasError('email') && emailForm.get('email')?.touched" class="text-danger">
              Ingrese un email <strong>válido</strong>
            </span>
            
            <div class="row mt-2 text-center">
              <div class="col-lg-6">
                <button type="button" class="btn btn-primary" (click)="goBack()">VOLVER</button>
              </div>
              <div class="col-lg-6">
                <button [disabled]="emailForm.invalid" type="submit" class="btn btn-info">ENVIAR CÓDIGO</button>
              </div>
            </div>
          </form>
        </div>

        <!-- Paso 2: Verificar código -->
        <div *ngIf="step === 2" class="card-header text-center">Verificar Código</div>
        <div *ngIf="step === 2" class="card-body">
          <form [formGroup]="codeForm" (ngSubmit)="verifyCode()">
            <p class="text-center mb-3">Ingresa el código de 6 dígitos enviado a tu email</p>
            <input formControlName="code" type="text" class="form-control mt-2" placeholder="Código de verificación" maxlength="6">
            <span *ngIf="codeForm.get('code')?.hasError('required') && codeForm.get('code')?.touched" class="text-danger">
              El código es <strong>requerido</strong>
            </span>
            <span *ngIf="codeForm.get('code')?.hasError('minlength') && codeForm.get('code')?.touched" class="text-danger">
              El código debe tener <strong>6 dígitos</strong>
            </span>
            
            <div class="row mt-2 text-center">
              <div class="col-lg-6">
                <button type="button" class="btn btn-primary" (click)="goBack()">VOLVER</button>
              </div>
              <div class="col-lg-6">
                <button [disabled]="codeForm.invalid" type="submit" class="btn btn-info">VERIFICAR</button>
              </div>
            </div>
          </form>
        </div>

        <!-- Paso 3: Nueva contraseña -->
        <div *ngIf="step === 3" class="card-header text-center">Nueva Contraseña</div>
        <div *ngIf="step === 3" class="card-body">
          <form [formGroup]="passwordForm" (ngSubmit)="resetPassword()">
            <div class="password-container">
              <input formControlName="password" [type]="hidePassword ? 'password' : 'text'" class="form-control mt-2" placeholder="Nueva contraseña">
              <i class="fa" [ngClass]="{'fa-eye-slash': hidePassword, 'fa-eye': !hidePassword}" (click)="togglePasswordVisibility()"></i>
            </div>
            <span *ngIf="passwordForm.get('password')?.hasError('required') && passwordForm.get('password')?.touched" class="text-danger">
              La contraseña es <strong>requerida</strong>
            </span>

            <div class="password-container">
              <input formControlName="confirmPassword" [type]="hideConfirmPassword ? 'password' : 'text'" class="form-control mt-2" placeholder="Confirmar contraseña">
              <i class="fa" [ngClass]="{'fa-eye-slash': hideConfirmPassword, 'fa-eye': !hideConfirmPassword}" (click)="toggleConfirmPasswordVisibility()"></i>
            </div>
            <span *ngIf="passwordForm.get('confirmPassword')?.hasError('required') && passwordForm.get('confirmPassword')?.touched" class="text-danger">
              Confirmar contraseña es <strong>requerido</strong>
            </span>
            <span *ngIf="passwordForm.get('confirmPassword')?.hasError('mismatch') && passwordForm.get('confirmPassword')?.touched" class="text-danger">
              Las contraseñas no coinciden
            </span>

            <div class="row mt-2 text-center">
              <div class="col-lg-6">
                <button type="button" class="btn btn-primary" (click)="goBack()">VOLVER</button>
              </div>
              <div class="col-lg-6">
                <button [disabled]="passwordForm.invalid" type="submit" class="btn btn-info">ACTUALIZAR</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>